<% if @appointment %>
  <h1>Video Call with <%= @appointment.doctor.first_name %></h1>

  <div id="meet"></div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const domain = "meet.jit.si";
      const roomName = "<%= @room_name %>";
      const options = {
        roomName: roomName,
        width: 800,
        height: 600,
        parentNode: document.querySelector("#meet"),
        userInfo: {
          displayName: "<%= current_doctor&.first_name || current_patient&.first_name %>"
        },
        configOverwrite: {
          startWithAudioMuted: false,
          startWithVideoMuted: false
        }
      };

      const api = new JitsiMeetExternalAPI(domain, options);

      // Debugging console log
      console.log("Jitsi Meet API Initialized:", api);

      api.executeCommand('displayName', "<%= current_doctor&.first_name || current_patient&.first_name %>");
    });
  </script>
<% else %>
  <p>Appointment not found.</p>
<% end %>
